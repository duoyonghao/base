<!DOCTYPE html>
<html>
<head lang="en">
    <meta name="viewport" content="width=device-width,initial-scale=1,mininum-scale=1,maxinum-scale=1,user-scaleable=no" charset="UTF-8">
    <title>预约页面</title>
    <link rel="stylesheet" href="../../static/css/wechat/weui.css"/>
    <link rel="stylesheet" href="../../static/css/wechat/jquery-weui.min.css"/>
    <link rel="stylesheet" href="../../static/css/wechat/kqdsWeixin.css"/>
    <style>
        .textTitle{
            text-align: center;
            color:#fff;
            background:#218BFF;
            vertical-align: middle;
            padding:5px 0;
            position:fixed;
            top:0;
            width:100%;
            height:40px;
            z-index: 1;
        }
        html{
        	height:100%;
        }
        body{
        	height:100%;
        }
    </style>
</head>
<body>
<!-- <h2 class="textTitle">客户预约</h2> -->
<!-- <div style=" overflow-y:auto;" class="contentDiv weui-cells weui-cells_form"> -->
    <div class="weui-tab">
        <div class="weui-tab__bd" >
                                                            <!--页面1：预约页面-->
            <div id="page1" class="weui-tab__bd-item weui-tab__bd-item--active" style="background:#f3f3f3;">
                <form id="orderForm">
                    <!-- <div class="weui-cell">
                        <div class="weui-cell__hd"><label class="weui-label">患者姓名</label></div>
                        <div class="weui-cell__bd">
                            <input id="username" name="username" class="weui-input" type="text"  placeholder="姓名">
                            <input id="seqId" name="seqId" type="hidden">
                            <input id="usercode" name="usercode" type="hidden">
                        </div>
                    </div> -->
                    <div class="kqds-yuyue-fatherDiv" style="margin-top:0px;">
                    
                    	<!--手机号码 -->
                    	<div class="kqds-yuyue-itemDiv" id="phonenumberDiv">
	                    	<div class="kqds-yuyue-itemDiv-leftDiv">
	                    		<span class="yuyueIcon icon-mobile" style="color:orange; font-size:22px;"></span>
	                    	</div>
	                    	<div class="kqds-yuyue-itemDiv-rightDiv">
	                    		<span class="yuyue-text">手机号码</span>
	                    		<span class="yuyue-component">
	                    			<input id="phonenumber" name="phonenumber" class="weui-input" type="text"  placeholder="手机号码"> 
	                    		</span>
	                    	</div>
	                    </div>
                    	
                    	<!--到院门诊  -->
	                    <div class="kqds-yuyue-itemDiv">
	                    	<div class="kqds-yuyue-itemDiv-leftDiv">
	                    		<span class="yuyueIcon icon-hospital" style="color:#92D949;"></span>
	                    	</div>
	                    	<div class="kqds-yuyue-itemDiv-rightDiv">
	                    		<span class="yuyue-text">到院门诊</span>
	                    		<span class="yuyue-component yuyue-trangleR">
	                    			<select id="organization" name="organization" class="weui-input" type="text"  placeholder="选择预约门诊"> </select>
	                        		<input id="openid" name="openid" type="hidden"> 
	                    		</span>
	                    	</div>
	                    </div>
                    	
                    	<!--预约日期  -->
	                    <div class="kqds-yuyue-itemDiv">
	                    	<div class="kqds-yuyue-itemDiv-leftDiv">
	                    		<span class="yuyueIcon icon-calendar" style="font-size:15px;color:cornflowerblue;"></span>
	                    	</div>
	                    	<div class="kqds-yuyue-itemDiv-rightDiv">
	                    		<span class="yuyue-text">预约日期</span>
	                    		<span class="yuyue-component yuyue-trangleR">
	                    			<input id="orderdate" name="orderdate" class="weui-input" type="text"  placeholder="选择预约日期">
	                    		</span>
	                    	</div>
	                    </div>
	                    
                    	<!--预约时间  -->
	                    <div class="kqds-yuyue-itemDiv">
	                    	<div class="kqds-yuyue-itemDiv-leftDiv">
	                    		<span class="yuyueIcon icon-time" style="color:cornflowerblue"></span>
	                    	</div>
	                    	<div class="kqds-yuyue-itemDiv-rightDiv">
	                    		<span class="yuyue-text">预约时间</span>
	                    		<span class="yuyue-component yuyue-trangleR">
	                    			<input id="ordertime" name="ordertime" class="weui-input" type="text"  placeholder="选择预约时间">
	                    		</span>
	                    	</div>
	                    </div>
	                    
                    	<!--预约项目  -->
	                    <div class="kqds-yuyue-itemDiv">
	                    	<div class="kqds-yuyue-itemDiv-leftDiv">
	                    		<span class="yuyueIcon icon-bars" style="color:#92D949;"></span>
	                    	</div>
	                    	<div class="kqds-yuyue-itemDiv-rightDiv" style="border-bottom:none;">
	                    		<span class="yuyue-text">预约项目</span>
	                    		<span class="yuyue-component yuyue-trangleR">
	                    			<select id="askitem" name="askitem" tig="ZXXM" class="weui-input dict" type="text"  placeholder="选择预约项目"> </select>
	                    		</span>
	                    	</div>
	                    </div>
                    </div>
                    
                    <div class="kqds-yuyue-fatherDiv">
                    	<!--选择症状（选填）  -->
                    	<div class="kqds-yuyue-itemDiv">
	                    	<div class="kqds-yuyue-itemDiv-leftDiv">
	                    		<span class="yuyueIcon icon-tag" style="color:orange;"></span>
	                    	</div>
	                    	<div class="kqds-yuyue-itemDiv-rightDiv" style="border-bottom:none;">
	                    		<span style="width:100%;" class="yuyue-text">选择症状（选填）</span>
	                    	</div>
	                    </div>
	                    
	                   <!--  <ul id="choiceSymptom" class="kqds-yuyue-choice">
	                    	<li>牙痛</li>
	                    	<li>牙酸</li>
	                    	<li>溃疡</li>
	                    	<li>蛀牙</li>
	                    	<li>牙龈出血</li>
	                    	<li>牙齿松动</li>
	                    	<li>牙齿黄</li>
	                    	<li>其他</li>
	                    </ul> -->
	                   	<div class="kqds-yuyue-choice">
	                    	<textarea id="askcontent" name="askcontent" placeholder="请描述您的咨询内容..."></textarea>
	                    </div>
                    </div>
                    
                    <div class="kqds-yuyue-fatherDiv">
                    	<button type="button" class="yuyue-btn" onclick="submitData()">立即预约</button>
                    </div>
                    <!-- <div class="kqds-yuyue-itemDiv">
                    	<div class="kqds-yuyue-itemDiv-leftDiv">
                    		<span class="yuyueIcon icon-user"></span>
                    	</div>
                    	<div class="kqds-yuyue-itemDiv-rightDiv" >
                    		<span class="yuyue-text">咨询内容</span>
                    		<span class="yuyue-component"  >
                    			<textarea id="askcontent" name="askcontent" class="weui-textarea" placeholder="请输入文本" rows="3"></textarea>
                            	<div class="weui-textarea-counter"><span>0</span>/200</div>
                    		</span>
                    	</div>
                    </div> -->
                    
                    <!--以下之前代码—————————————————————————— -->
                    <!-- <div class="weui-cell" id="phonenumberDiv">
                        <div class="weui-cell__hd"><label class="weui-label">手机号码</label></div>
                        <div class="weui-cell__bd">
                            <input id="phonenumber" name="phonenumber" class="weui-input" type="text"  placeholder="手机号码">  
                        </div>
                    </div>
                    <div class="weui-cell">
                        <div class="weui-cell__hd"><label class="weui-label">到院门诊</label></div>
                        <div class="weui-cell__bd">
                            <select id="organization" name="organization" class="weui-input" type="text"  placeholder="选择预约门诊"> </select>
                        		<input id="openid" name="openid" type="hidden">
                        </div>
                    </div>
                    <div class="weui-cell">
                        <div class="weui-cell__hd"><label class="weui-label">预约日期</label></div>
                        <div class="weui-cell__bd">
                            <input id="orderdate" name="orderdate" class="weui-input" type="text"  placeholder="选择预约日期">
                        </div>
                    </div> 
                    <div class="weui-cell">
                        <div class="weui-cell__hd"><label class="weui-label">预约时间</label></div>
                        <div class="weui-cell__bd">
                            <input id="ordertime" name="ordertime"  class="weui-input" type="text"  placeholder="选择预约时间">
                        </div>
                    </div>
                    <div class="weui-cell">
                        <div class="weui-cell__hd"><label class="weui-label">预约项目</label></div>
                        <div class="weui-cell__bd">
                             <select id="askitem" name="askitem" tig="ZXXM" class="weui-input dict" type="text"  placeholder="选择预约项目"> </select>
                        </div>
                    </div>	
                    <div class="weui-cell">
                        <div class="weui-cell__hd"><label class="weui-label">咨询内容</label></div>
                        <div class="weui-cell__bd">
                            <textarea id="askcontent" name="askcontent" class="weui-textarea" placeholder="请输入文本" rows="3"></textarea>
                            <div class="weui-textarea-counter"></div>
                        </div>
                    </div>	
                    <div class="weui-cell">
                        <div class="weui-cell__hd"></div>
                        <div class="weui-cell__bd">
                            <a href="javascript:;" class="weui-btn weui-btn_primary" onclick="submitData()">提交</a>
                        </div>
                    </div>	-->
                </form>
            </div>
    </div>
<!-- </div> -->


<script type="text/javascript" src="../../static/js/wechat/jquery-2.1.4.js"></script>
<script type="text/javascript" src="../../static/plugin/layer-v2.4/layer/layer.js"></script>
<script type="text/javascript" src="../../static/js/wechat/jquery-weui.js"></script>
<script type="text/javascript" src="../../static/js/kqdsFront/util.js"></script>
<script type="text/javascript" src="../../static/js/wechat/kqds_wechat.js?version=1.7"></script>
<script>
$(function() {
    var contentHeight = $(window).height() - $(".textTitle").outerHeight();
    $(".contentDiv").outerHeight(contentHeight);

    // $("#username").val(wxObj.username);
    // $("#usercode").val(wxObj.usercode);
    $("#openid").val(wxObj.openid);
    
    initHosSelectListNoCheck('organization');
    
    initDictSelectByClass();
    
    if(!wxObj.phonenumber){ // 手机号码不存在时，说明当前微信用户，没有绑定user
    	$("#phonenumber").removeAttr("readonly");
    }else{
    	$("#phonenumber").attr("readonly","readonly");
    	$("#phonenumber").val(wxObj.phonenumber);
    }
});

/*提交按钮*/
function submitData() {
    var orderdate = $("#orderdate").val();
    var ordertime = $("#ordertime").val();
    var askitem = $("#askitem").val();
    var phonenumber = $("#phonenumber").val();
    
    if(!wxObj.phonenumber){ // 手机号码不存在时，说明当前微信用户，没有绑定user
    	if(!checkPhone()){
        	alert("手机号码有误，请重填");  
        	return false;
        };
    }else{
    	if (phonenumber == "") {
   	        alert("手机号码不能为空");
   	        return false;
	    }
    	 
    	if (phonenumber.length < 8) {
   	        alert("号码长度不能小于8");
   	        return false;
 	    }
    }
    if (orderdate == "") {
        alert("预约日期不能为空");
        return false;
    }else{
    	orderdate = $.trim(orderdate);
    	$("#orderdate").val(orderdate);
    }

    if (ordertime == "") {
        alert("预约时间不能为空");
        return false;
    }
    
    if (askitem == "") {
        alert("预约项目不能为空");
        return false;
    }
    
    var currDateTime = getNowFormatTime();
    var selectDateTime = orderdate + " " + ordertime.split("~")[0] + ":00";
    var flag = checkdate(currDateTime, selectDateTime);
	/* if(flag == 0){
		alert("预约时间不能早于当前时间");
		return false;
	} */
  //询问框
    layer.confirm('确定预约？', {
        btn: ['确定', '取消'] //按钮
    },
    function() {
    	var param = $("#orderForm").serialize(); //获得表单数据
        var url = wxOrderObj.insertOrUpdate + "&" + param;
        var returnData = getDataFromServer(url);
        if (returnData.retState == 0) {
        	layer.alert('预约成功！', {
                end: function() {
                    window.location.href = contextPath + "/wechat/order/orderSuccess.html";
                }
            });
        } else {
        	layer.alert('预约失败！', {
            });
            return false;
        }
    });
}
/*症状选择的js 选中的按钮颜色变化*/ 
/* $("#choiceSymptom").on("click","li",function(e){
	$(this).addClass("dodgerblue").siblings("li").removeClass("dodgerblue");
	
}) */
/** 暂未使用 **/
$("#department").picker({
    title: "请选择预约门诊",
    cols: [{
        textAlign: 'center',
        values: ['市南口腔', '市北口腔', '长沙口腔', '北京口腔']
    }],
    onOpen: function() {
        $("*").blur();
    }
});

$("#orderdate").datetimePicker({
    onOpen: function() {
        $("*").blur();
    },
    times: function () {
        return [
        ];
      }
});

$("#ordertime").picker({
    title: "请选择预约时间",
    cols: [{
        textAlign: 'center',
        values: ['08:00~09:00', '09:00~10:00', '11:00~12:00', '12:00~13:00', '13:00~14:00', '14:00~15:00', '15:00~16:00', '16:00~17:00', '17:00~18:00']
    }],
    onOpen: function() {
        $("*").blur();
    }
});

//手机号码验证
function checkPhone(){ 
    var phone = document.getElementById('phonenumber').value;
    if(!(/^1[34578]\d{9}$/.test(phone))){ 
        return false; 
    } else{
    	return true;
    }
}
</script>
</body>
</html>